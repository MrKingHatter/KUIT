<!DOCTYPE html>
<html>
    <head>
        <title>KU-IT udleveringstekst</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link rel="stylesheet" href="styles.css">
        <script src="template.txt"></script>
        <script>         
          window.onload = readFile;

          function parseLate(open, shut, prep, clos) {
            const zeroPad = (num, places) => String(num).padStart(places, '0')

            const [ohour, ominute] = open.split(":").map(function(e){ return parseInt(e); });
            const [shour, sminute] = shut.split(":").map(function(e){ return parseInt(e); });
            const [phour, pminute] = prep.split(":").map(function(e){ return parseInt(e); });
            const [chour, cminute] = clos.split(":").map(function(e){ return parseInt(e); });
            var today = new Date();
            open = new Date(today.setHours(ohour+phour, ominute+pminute));
            shut =  new Date(today.setHours(shour-chour, sminute-cminute));
            
            open = zeroPad(open.getHours(), 2) + ":" + zeroPad(open.getMinutes(), 2);
            shut = zeroPad(shut.getHours(), 2) + ":" + zeroPad(shut.getMinutes(), 2);

            return [open, shut];
          }

          function generateText() {
            var text = document.getElementById("template").value;
            var send = document.getElementById("send").value;
            var name = document.getElementById("user").value;
            var numb = document.getElementById("case").value;
            var open = document.getElementById("open").value;
            var shut = document.getElementById("shut").value;
            var prep = document.getElementById("prep").value;
            var clos = document.getElementById("clos").value;

            [prep, clos] = parseLate(open, shut, prep, clos);
        
            text = text.replaceAll("[User]", name);
            text = text.replaceAll("[Case]", numb);
            text = text.replaceAll("[Send]", send);
            text = text.replaceAll("[Open]", open);
            text = text.replaceAll("[Shut]", shut);
            text = text.replaceAll("[Prep]", prep);
            text = text.replaceAll("[Clos]", clos);
        
            document.getElementById("result").value = text;
        
            return false;
          }
          
          function copy2Clipboard() {
            var copyText = document.getElementById("result").value;
            navigator.clipboard.writeText(copyText);
            var oldtext = document.getElementById("copy").innerHTML;
            document.getElementById("copy").innerHTML = "Copied to clipboard";
            setTimeout(function() { 
              document.getElementById("copy").innerHTML = oldtext;
            }, 2000);
          }

          function readFile() {
            document.getElementById("template").value = template.substring(1, template.length-1);;
          }
        </script>
        
    </head>
    <body>
        <h1>
            KU-IT udleveringstekst
          </h1>
          <div class="inputDiv">
            <form>
              <input type="time" id="open" value="08:00">
              <input type="time" id="shut" value="16:00">
              <input type="time" id="prep" value="00:30">
              <input type="time" id="clos" value="00:30">
            </form>
          </div>
          <div class="inputDiv">
            <form>
              <input type="text" id="send" placeholder="Senders name" value="KU-IT Support">
              <input type="text" id="user" placeholder="Users name">
              <input type="text" id="case" placeholder="Case number">
              <input type="submit" value="Auto-fill" onclick="return generateText()">
            </form>
          </div>
          <div class="textManager">
            <div class="templateManager">
              <h4>
                Template:
              </h4>
              <textarea id="template" rows=40 value="template.txt"></textarea>
            </div>
            <div class="resultManager">
              <h4>
                Result:
              </h4>
              <textarea id="result" placeholder="Click Auto-fill to generate text" readonly rows=40></textarea>
              <button onclick="copy2Clipboard()" id="copy">
                Copy to clipboard
              </button>
            </div>
          </div> 
    </body>
</html>
